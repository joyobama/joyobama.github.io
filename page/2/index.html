<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Time is Gone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="乱七八糟的记录，我正在努力尝试弄得有条理一些">
<meta property="og:type" content="website">
<meta property="og:title" content="Time is Gone">
<meta property="og:url" content="https://joyobama.github.io/page/2/index.html">
<meta property="og:site_name" content="Time is Gone">
<meta property="og:description" content="乱七八糟的记录，我正在努力尝试弄得有条理一些">
<meta property="og:locale">
<meta property="article:author" content="Joy_Obama">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Time is Gone" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Time is Gone</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Joy_Obama</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://joyobama.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-钴基非晶磁通门仿真" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/06/%E9%92%B4%E5%9F%BA%E9%9D%9E%E6%99%B6%E7%A3%81%E9%80%9A%E9%97%A8%E4%BB%BF%E7%9C%9F/" class="article-date">
  <time class="dt-published" datetime="2022-10-06T13:00:15.669Z" itemprop="datePublished">2022-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>根据近几年博士学位论文，采用钴基非晶材料制作磁通门可获得非常高的测量精度。文献总结另外再写。</p>
<h1 id="钴基非晶带材-Cobalt-based-amorphous-ribbon"><a href="#钴基非晶带材-Cobalt-based-amorphous-ribbon" class="headerlink" title="钴基非晶带材(Cobalt based amorphous ribbon)"></a>钴基非晶带材(Cobalt based amorphous ribbon)</h1><p>钴基非晶合金带材$CoNiFeSiB$由铁、钴、硅、硼组成，具有高磁导率、低矫顽力、极低损耗及良好的温度稳定性、接近零的磁致伸缩系数等特点。对机械应力不敏感，可以长期工作在恶劣环境中，大大提高产品器件的稳定性和可靠性，尤其适合军工电源中的变压器、电感等，替换坡莫合金和铁氧体。之前制作的磁通门传感器就是采用坡莫合金，但是坡莫合金高频性能有限，不能进一步小型化，故近两年的博士都是采用钴基非晶材料。</p>
<p>国产的钴基非晶材料牌号为CACO-01，CACO-02，其性能参数如下表所示：</p>
<p><a target="_blank" rel="noopener" href="https://www.transmart.net/cobalt-based-amorphous-ribbons"><strong>PERFORMANCE OF COBALT-BASED AMORPHOUS STRIP</strong></a></p>
<p>Cobalt based Amorphous ribbons</p>
<table>
<thead>
<tr>
<th><strong>Item</strong></th>
<th><strong>Grade CACO-01</strong></th>
<th><strong>Grade CACO-02</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Strip thickness (<em>μ</em>m)</td>
<td>18-25</td>
<td>18-25</td>
</tr>
<tr>
<td>Fill factor σ</td>
<td>&gt;0.8</td>
<td>&gt;0.8</td>
</tr>
<tr>
<td>Magnetic induction B800&#x2F;T</td>
<td>&gt;0.55</td>
<td>≥0.9</td>
</tr>
<tr>
<td>Coercivity <em>H</em>c (A&#x2F;m)</td>
<td>&lt;0.13</td>
<td>≤1.0</td>
</tr>
<tr>
<td>Iron loss P0.4T&#x2F;50k (W&#x2F;kg)</td>
<td>&lt;65</td>
<td></td>
</tr>
<tr>
<td>Initial magnetic conductivity µ0</td>
<td>&gt;60000</td>
<td>&gt;60000</td>
</tr>
<tr>
<td>Maximum magnetic permeability µ max</td>
<td>1000000</td>
<td>1000000</td>
</tr>
<tr>
<td>Curie temperature (℃)</td>
<td>255</td>
<td>485</td>
</tr>
<tr>
<td>Resistivity (<em>μ</em>ΩNaN)</td>
<td>120</td>
<td>120</td>
</tr>
<tr>
<td>Continuous working temperature (℃)</td>
<td>-40-90</td>
<td>-40-90</td>
</tr>
<tr>
<td>magnetostriction λs</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><strong>Part No.</strong></th>
<th><strong>Width(mm)</strong></th>
<th><strong>Thickness (μm)</strong></th>
</tr>
</thead>
<tbody><tr>
<td>JCACO020232</td>
<td>2</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO030232</td>
<td>3</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO032232</td>
<td>3.2</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO045232</td>
<td>4.5</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO050232</td>
<td>5</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO060232</td>
<td>6</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO065232</td>
<td>6.5</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO080232</td>
<td>8</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO100232</td>
<td>10</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO150232</td>
<td>15</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO200232</td>
<td>20</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO250232</td>
<td>25</td>
<td>18-25</td>
</tr>
<tr>
<td>JCACO300232</td>
<td>30</td>
<td>18-25</td>
</tr>
</tbody></table>
<p>但是这里的数据给的比较笼统不方便对软磁材料进行建模，找到一篇论文：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S0304885320322952?via=ihub">Soft magnetic cobalt based amorphous alloys with low saturation induction</a></p>
</blockquote>
<p>上面给出了一些钴基非晶材料的一些较为详细的参数，如下表所示：</p>
<p><strong>Magnetic properties of the amorphous alloys Co–Fe–Si–B after various thermal treatments</strong></p>
<table>
<thead>
<tr>
<th align="left">Alloy</th>
<th align="left">Composition, at. %</th>
<th><em>Bm</em>, T at magnetic field 200 A&#x2F;m</th>
<th align="left"><em>μi</em></th>
<th align="left"><em>μmax</em></th>
<th><em>Hμmax</em>, A&#x2F;m</th>
<th><em>HC</em>, A&#x2F;m (magnetic induction 0.2 T)</th>
<th align="left"><em>TC</em>, K</th>
</tr>
</thead>
<tbody><tr>
<td align="left">#1</td>
<td align="left">Co66Fe4Mo0.5Ni0.5Si15.5B13.5</td>
<td>0.55</td>
<td align="left">50,000</td>
<td align="left">195,000</td>
<td>1.4</td>
<td>0.3</td>
<td align="left">491</td>
</tr>
<tr>
<td align="left">#2</td>
<td align="left">Co66.5Fe4Mo1.5B12Si16</td>
<td>0.51</td>
<td align="left">75,650</td>
<td align="left">228,500</td>
<td>0.977</td>
<td>0.33</td>
<td align="left">413</td>
</tr>
<tr>
<td align="left">#3</td>
<td align="left">Co68Fe3.2Cr2.8B9Si17</td>
<td>0.5</td>
<td align="left">108,100</td>
<td align="left">180,000</td>
<td>1.1</td>
<td>0.15</td>
<td align="left">393</td>
</tr>
<tr>
<td align="left"><strong>#4</strong></td>
<td align="left"><strong>Co67Fe3.2Cr2.8B10Si17</strong></td>
<td><strong>0.55</strong></td>
<td align="left"><strong>126,000</strong></td>
<td align="left"><strong>260,000</strong></td>
<td><strong>0.9</strong></td>
<td><strong>0.11</strong></td>
<td align="left"><strong>388</strong></td>
</tr>
<tr>
<td align="left">#5</td>
<td align="left">Co65,5Fe3.5Cr3B10Si18</td>
<td>0.42</td>
<td align="left">230,000</td>
<td align="left">450,000</td>
<td>0.41</td>
<td>0.159</td>
<td align="left">364</td>
</tr>
<tr>
<td align="left">#6</td>
<td align="left">Co65Fe3.2Cr2.8B10Si19</td>
<td>0.35</td>
<td align="left">165,000</td>
<td align="left">425,000</td>
<td>0.49</td>
<td>0.122</td>
<td align="left">321</td>
</tr>
<tr>
<td align="left">#7</td>
<td align="left">Co65Fe3.8Cr2.2B11.5Si17.5</td>
<td>0.5</td>
<td align="left">65,000</td>
<td align="left">145,000</td>
<td>1.2</td>
<td></td>
<td align="left">393</td>
</tr>
<tr>
<td align="left">#8</td>
<td align="left">Co66Fe3.8Cr1.2B12Si17</td>
<td>0.5</td>
<td align="left">100,000</td>
<td align="left">170,000</td>
<td>0.9</td>
<td>0.2</td>
<td align="left">449</td>
</tr>
<tr>
<td align="left">#9</td>
<td align="left">Co65Fe4Cr1Mo1B11.8Si17.2</td>
<td>0.45</td>
<td align="left">60,000</td>
<td align="left">140,000</td>
<td>1.05</td>
<td></td>
<td align="left">399</td>
</tr>
<tr>
<td align="left">#10</td>
<td align="left">Co66.7Fe3.1Cr3.2B12Si15</td>
<td>0.44</td>
<td align="left">135,000</td>
<td align="left">300,000</td>
<td>0.55</td>
<td>0.14</td>
<td align="left">440</td>
</tr>
<tr>
<td align="left">#11</td>
<td align="left">Co67Fe3Cr3B11,5Si15.5</td>
<td>0.43</td>
<td align="left">140,000</td>
<td align="left">320,000</td>
<td>0.5</td>
<td>0.13</td>
<td align="left">443</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">Co67Fe3Cr3B12Si15</td>
<td>0.45</td>
<td align="left">150,000</td>
<td align="left">350,000</td>
<td>0.5</td>
<td>0.11</td>
<td align="left">458</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">Co66Fe3Cr6B15Si10</td>
<td>0.38</td>
<td align="left">125,000</td>
<td align="left"></td>
<td></td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">Co66Fe3Cr9B14Si8</td>
<td>0.38</td>
<td align="left">55,000</td>
<td align="left"></td>
<td></td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Permaloy 81HMA Thickness 50 μm [<a target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S0304885320322952?via=ihub#b0295">59]</a></td>
<td>0.5</td>
<td align="left">60,000</td>
<td align="left">140,000</td>
<td>1.6</td>
<td>≥0.4</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>对比两个表格，发现国产磁牌号CACO-01最相近的为#4，因为磁导率与温度相关，还与磁场的频率，幅值等相关，所以需要具体的一些数据曲线，进行建模分析。      </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://joyobama.github.io/2022/10/06/%E9%92%B4%E5%9F%BA%E9%9D%9E%E6%99%B6%E7%A3%81%E9%80%9A%E9%97%A8%E4%BB%BF%E7%9C%9F/" data-id="cl8x3ovs4000bbgoc2rbib2ab" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Vivado_FIR使用记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/06/Vivado_FIR%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2022-10-06T13:00:15.667Z" itemprop="datePublished">2022-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/06/Vivado_FIR%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/">Vivado FIR Compiler 7.2使用记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Vivado-FIR-Compiler-7-2使用记录"><a href="#Vivado-FIR-Compiler-7-2使用记录" class="headerlink" title="Vivado FIR Compiler 7.2使用记录"></a>Vivado FIR Compiler 7.2使用记录</h1><p>参考连接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1801170">matlab与FPGA数字滤波器设计（1）——通过matlab的fdatool工具箱设计FIR数字滤波器 - 云+社区 - 腾讯云 (tencent.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1801172">matlab与FPGA数字滤波器设计（2）——Vivado调用IP核设计FIR滤波器 - 云+社区 - 腾讯云 (tencent.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1801173">matlab与FPGA数字滤波器设计（3）—— Matlab 与 Vivado 联合仿真 FIR 滤波器 - 云+社区 - 腾讯云 (tencent.com)</a></li>
</ul>
<p>分为两步，生成滤波器系数和设置FIR Compiler 7.2例化IP。</p>
<h2 id="MATLAB-FDAtool"><a href="#MATLAB-FDAtool" class="headerlink" title="MATLAB-FDAtool"></a>MATLAB-FDAtool</h2><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204172214385.png" alt="image-20220417221426263"></p>
<p>这个工具是matlab常用的工具，不同版本名字不一样，Filter Designer或FDATOOL或者滤波器设计工具，一般可以在matlab的APP中可以找到。先左下角的几个图标，一般默认是最下面那个，滤波器设计，用的最多的也是这个。这里需要注意的几个点如下</p>
<ul>
<li><p>阶数其实就是点数，FIR阶数与点数相差1，阶数等于点数减1；一般来说阶数越高效果越好，但延时高，要与采样频率相匹配，采样速率高，多几个点也没有什么关系。</p>
</li>
<li><p>数字滤波器与模拟滤波器有非常大的区别，模拟滤波器非常灵活，但数字滤波器基本上都是根据采样频率归一化后的若干个，可以直接查表选择所需要的类型。根据数字信号处理教材里有非常多种设计方法，最简单的即为窗方法，最直观。因为这里不需要深究滤波器性能，重点在于使用。根据查找对比，Blackman窗是旁瓣抑制较好，经典，就是主瓣太宽，不过因为采样频率足够高，可以通过增加阶数的方式得到较好的效果。Blackman窗旁瓣抑制为-57dB，主瓣宽度为12pi&#x2F;N，在设置截止频率时不应超出这个宽度，只能通过调整采样率或者阶数实现，或者换一种窗结构。</p>
</li>
<li><p>IIR与FIR的区别在于，IIR的相位响应是非线性的，一般需要加带通滤波器进行相位矫正，两者加起来的资源消耗与FIR相当甚至更多。所以一般数字滤波器都采用FIR滤波器，其相位响应为线性。</p>
</li>
<li><p>数字滤波器与模拟滤波器不同在于，数字系统每个计算时刻，都认为系统是稳态的，这是数字信号处理的一个基础。</p>
</li>
<li><p>工具默认是采用双精度浮点系数，但浮点运算在任何平台都是非常麻烦的一件事情，资源消耗特别大，适合在通用PC保证计算精度，在底层逻辑计算平台上要尽量避免浮点运算，需要转换为定点型系数。学术版matlab没有定点运算权限，正版软件受害者实锤。设置定点型滤波器在左下角第三图标，如下图所示，参考别人的经验，一般采用采用16位量化会比较好，在VIVADO设置IP时也会提及量化，VIVADO对定点型支持较好。</p>
<p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204172245289.png" alt="image-20220417224521232"></p>
</li>
<li><p>在没有权限，正版软件受害的情况下，可在matlab里面将里面的双精度系数乘以$2^{16}-1$再取整。另外，定点化会极大影响系数精度，从而影响滤波器性能，在设计过程中，可以看见对比情况，一般还是避免正版受害的情况，在工具箱中调整设计一个较好的系数。</p>
</li>
<li><p>最后导出是在<strong>目标</strong>，有Xilinx字样，coe是Xilinx专用系统格式。</p>
</li>
<li><p>这里最佳精度小数长度刚好是0，如果依然有小数，应该再这里设置将小数位数置零，小数很麻烦。一般定点化都会是整数。</p>
</li>
</ul>
<h2 id="FIR-Compiler-7-2"><a href="#FIR-Compiler-7-2" class="headerlink" title="FIR Compiler 7.2"></a>FIR Compiler 7.2</h2><p>这个应该是非常常用的一个IP了，数字信号处理大部分时候都要滤波，还有另外一个非常重要的则是DDS，VIVADO提供的DDS还有FIR核都是采用AXI4-STEAM协议，搞得很麻烦。搞得还要去学习一下协议，但是这个是在构建复杂系统才用到，这里其实没有什么用，一般情况下<strong>s_axis_data_tvalid</strong>都是置1拉高，输入信号也就三个，一个数据输入，一个时钟，一个数据有效使能。三个输出，一个数据输出，一个数据有效使能输出，一个已准备输出。两个使能信号可不管。</p>
<p>寻找IP在旁边的Flow Navigator里面的 IP Catalog里面。找到对应的FIR compiler。左边框为IP设置状态，右面为设置窗口，主要说明设置窗口。共六个标签页，逐个说明一下。</p>
<h3 id="Filter-Option"><a href="#Filter-Option" class="headerlink" title="Filter Option"></a>Filter Option</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181055603.png" alt="image-20220418105537533"></p>
<p>滤波器系数那里选择源为COE文件，就从matlab里面导出的文件，这个文件最好放在vivado的工程目录下，名字和路径都不应该有中文和空格，vivado作为一个专业软件，其兼容性较差，对中文基本没有支持，空格也很容易出错，一般用下划线或者骆驼峰命名法。选择完用哪个小文件夹按钮浏览找到放置的COE文件即可从，下面的几个基本上不用动，系数用一组，也不重载，资源大把，不够就再买一块。</p>
<p>下面的Filter Specification 滤波器类型选最典型的单速率模式，即输出频率与输出的频率一致，剩下的也不用动，也动不了。</p>
<h3 id="Channel-Specification"><a href="#Channel-Specification" class="headerlink" title="Channel Specification"></a>Channel Specification</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181102103.png" alt="image-20220418110245037"></p>
<p>通道选一个，通道顺序选基本顺序，因为就一个，所以没有什么需要调整的，并行路径选一个，资源大把，不要考虑这些问题，下面的过采样设置，因为主体时钟是50MHz，数据采样率为2.5MHz，也可以都选2.5MHz，但这里选用了主时钟，进行了过采样，会多消耗一些资源，响应稍微快一点。</p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181118768.png" alt="image-20220418111817693"></p>
<p>系数选项要与matlab里面的设置一致，有符号系数，这里也提到了量化，并且是整数量化，并且不能更改，可能是因为已经导入了系数，但整数量化对FPGA要友好很多，所以一般量化还是需要整数量化，另外量化的位宽是可以调整的，但为了保证精度还是与matlab里面一致，16位位宽。系数选项最后一栏为系数结构，这里选择inferred，让软件自己推断。</p>
<p>最后数据路径选项比较重要，这里我们输入数据为为有符号的12位数据，但是为了与AXI4-stream协议统一，扩展到16位，后面四位补零，将信号扩大16倍，没有小数位。在输出的位宽是36位，全精度位宽太大，考虑到后续的模组开销，并不需要这么高的精度，统一为16位精度输出，取整方式为直接在最底位截断，不输出小数位。</p>
<h3 id="Detailed-Implementation"><a href="#Detailed-Implementation" class="headerlink" title="Detailed Implementation"></a>Detailed Implementation</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181605756.png" alt="image-20220418160547679"></p>
<p>主要是优化目标，我们这里需要的是速度，最后的DSP切片栏，可以适当选多一点。</p>
<h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181611174.png" alt="image-20220418161138112"></p>
<p>这里主要要启用复位信号。</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p><img src="https://joyobama.oss-cn-guangzhou.aliyuncs.com/img/202204181612401.png" alt="image-20220418161224335"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://joyobama.github.io/2022/10/06/Vivado_FIR%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" data-id="cl8x3ovrw0004bgoc8z6m2h7t" data-title="Vivado FIR Compiler 7.2使用记录" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Verilog有符号数与无符号数的一些要点" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/06/Verilog%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B0%E4%B8%8E%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A6%81%E7%82%B9/" class="article-date">
  <time class="dt-published" datetime="2022-10-06T13:00:15.665Z" itemprop="datePublished">2022-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/06/Verilog%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B0%E4%B8%8E%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A6%81%E7%82%B9/">Verilog 有符号数与无符号数的一些注意点</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="有符号数（负数）与无符号数"><a href="#有符号数（负数）与无符号数" class="headerlink" title="有符号数（负数）与无符号数"></a>有符号数（负数）与无符号数</h1><p>参考连接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dadaozhijian22/p/8778636.html">关于verilog的有符号数与无符号数的转换 - Carzy_Learner - 博客园 (cnblogs.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sz_woshishazi/article/details/108773295">数字IC秋招面试专题（二）verilog的signed和unsigned_王_嘻嘻的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Times_poem/article/details/84997976?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.pc_relevant_default&spm=1001.2101.3001.4242.1&utm_relevant_index=3">Verilog十大基本功5 (关于verilog中的signed类型)_Times_poem的博客-CSDN博客</a></li>
</ul>
<p>因为做数字信号处理的时候发现AD输入数据，DA输出数据都是无符号整数，但是其中有需要进行乘法、开方、滤波等一系列操作。AD与DA的无符号数据都是因为将将信号进行了偏置，当进行乘法计算时会有：<br>$$<br>S_1 &#x3D; A\sin(\omega_1 t + \phi_1)\<br>S_2 &#x3D; B\sin(\omega_2 t + \phi_2)\<br>S_1S_2 &#x3D; AB\sin(\omega_1 t + \phi_1)\sin(\omega_2 t + \phi_2)\<br>S^*_1 &#x3D; \frac{A}{2}+A\sin(\omega_1 t + \phi_1)\<br>S^*_2 &#x3D; \frac{B}{2}+B\sin(\omega_2 t + \phi_2)\<br>S^*_1S^*_2&#x3D;\frac{S_1S_2}{2}+\frac{AB}{2}(\sin(\omega_1 t + \phi_1)+\sin(\omega_2 t + \phi_2)+\frac{1}{2})<br>$$<br>所以在进行相关性解调，求幅值的操作中，无符号这种偏置操作会影响计算的精度与效率，信噪比明显下降。</p>
<p>故将将无符号数转换为有符号数是十分有必要的。</p>
<h2 id="无符号数转有符号数"><a href="#无符号数转有符号数" class="headerlink" title="无符号数转有符号数"></a>无符号数转有符号数</h2><p>在Verilog中提供了两个系统函数进行两者的转换，分别是将无符号数转为有符号数的$$signed$和将有符号数转为无符号数的$$unsigned$，相关示例如下：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] regA, regB;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] regS;</span><br><span class="line">regA = <span class="built_in">$unsigned</span>(-<span class="number">4</span>); <span class="comment">// regA = 8&#x27;b11111100</span></span><br><span class="line">regB = <span class="built_in">$unsigned</span>(-<span class="number">4</span>&#x27;sd4); <span class="comment">// regB = 8&#x27;b00001100</span></span><br><span class="line">regS = <span class="built_in">$signed</span> (<span class="number">4&#x27;b1100</span>); <span class="comment">// regS = -4</span></span><br></pre></td></tr></table></figure>

<p>从上面几个示例可以看出，在使用$signed函数时，有以下几个特点</p>
<ul>
<li>会自动将最高位作为符号位</li>
<li>不会增加或减少位数，故在处理1’b1时无法判断其为符号位或数字有效位，在处理需要注意</li>
<li>不会更改寄存器中的值，只是在综合时有意义</li>
<li>在赋值时，有符号数在进制带有s</li>
<li>有符号数都是以补码的形式存在的，所无符号数转过去并非是单纯的将最高做作为符号位，而是因为整数的补码与原码相同</li>
</ul>
<p>而在使用$unsigned函数时，同样不会更改内容，结合无符号与有符号计算的一些特性，该函数非常少使用。总的来说，值还是那些值，但是所代表的意义，以及在综合时的逻辑关系不一样了。Verilog一般默认都是采用无符号整数，有符号的都需要特别申明。</p>
<h2 id="有符号数与无符号数的运算规则"><a href="#有符号数与无符号数的运算规则" class="headerlink" title="有符号数与无符号数的运算规则"></a>有符号数与无符号数的运算规则</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">the following are the rules for determining the resulting type of an expression</span></span><br><span class="line"><span class="comment">-----expression type depends only on the oprands .It does not depend on the left-hand(if any)</span></span><br><span class="line"><span class="comment">-----decimal numbers are signed </span></span><br><span class="line"><span class="comment">-----based_numbers are unsigned,except where the s notation is used in the based specifier</span></span><br><span class="line"><span class="comment">-----bit-select results are unsigned , regardless of the oprands</span></span><br><span class="line"><span class="comment">-----part-select results are unsigned ,regradless of oprands</span></span><br><span class="line"><span class="comment">-----part-select results are unsigned regardless of the oprands even if the part-select specifes the entire vector</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] a;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] b;</span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line">a = b[<span class="number">7</span>:<span class="number">0</span>]; <span class="comment">// b[7:0] is unsigned and therefore zero-extended</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">-----concatenate result are unsigned regtadless of the oprands</span></span><br><span class="line"><span class="comment">-----comparison results (1,0) are unsigned regradless of the oprands</span></span><br><span class="line"><span class="comment">-----reals converted to integers by type coercion are signed</span></span><br><span class="line"><span class="comment">-----the sign and size of any self-determined operand are determined by the operand itself and independent of the remainder of the expression </span></span><br><span class="line"><span class="comment">-----for nonself-determined operands the follwing rules apply</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if any operand is real the result is real </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if any operand is unsigned the result is unsigned regardless of the operator(运算符) except when specified otherwise</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> If a signed operand is to be resized to a larger signed width and the value of the sign bit is X, the resulting value shall be bit-filled with Xs. If the sign bit of the value is Z, then the resulting value shall be bit-filled with Zs. If any bit of a signed value is X or Z, then any nonlogical operation involving the value shall result in the entire resultant value being an X and the type consistent with the expression’s type.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">If the width of the right-hand expression is larger than the width of the left-hand side in an assignment, the MSBs of the right-hand expression will always be discarded to match the size of the left-hand side. Implementations are not required to warn or report any errors related to assignment size mismatch or truncation. Truncating the sign bit of a signed expression may change the sign of the result.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">                                                                                                                                                                          </span><br><span class="line"><span class="comment">//For example:</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">5</span>:<span class="number">0</span>] a;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] b;</span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">a = <span class="number">8&#x27;hff</span>; <span class="comment">// After the assignment, a = 6&#x27;h3f</span></span><br><span class="line">b = <span class="number">8&#x27;hff</span>; <span class="comment">// After the assignment, b = 5&#x27;h1f</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">//For example:</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">5</span>:<span class="number">0</span>] a;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] b, c;</span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">a = <span class="number">8</span>&#x27;sh8f; <span class="comment">// After the assignment, a = 6&#x27;h0f</span></span><br><span class="line">b = <span class="number">8</span>&#x27;sh8f; <span class="comment">// After the assignment, b = 5&#x27;h0f</span></span><br><span class="line">c = -<span class="number">113</span>; <span class="comment">// After the assignment, c = 15</span></span><br></pre></td></tr></table></figure>

<ul>
<li>运算中存在无符号数时，一律按照无符号数运算，仅当所有运算数都为有符号数时，才会按照有符号数进行运算。</li>
<li>只要发生截位的情况，例如左边操作操作数位数小于右边操作数，一律按照无符号数操作。</li>
<li>当右值位数不等时进行运算，小位宽数会先扩位到大位宽再参与运算；扩位按最高位进行扩，所以要<strong>尤其注意正负</strong>，所以最好保证都是相同位数，并考虑溢出情况。</li>
</ul>
<h2 id="AD-x2F-DA操作时的有无符号数的转换"><a href="#AD-x2F-DA操作时的有无符号数的转换" class="headerlink" title="AD&#x2F;DA操作时的有无符号数的转换"></a>AD&#x2F;DA操作时的有无符号数的转换</h2><p>因为AD或DA芯片一般都是只能采样或者输出正电压，AD采集以及DA输出时的数据都是无符号数，但在计算时需要有符号数，故在进行输入输出时需要将其进行转换。有网友提出了一种便捷的方式将两者进行转换，主要体现在最高位上。无符号数是加了$2^{N-1}$偏置，需要减去这一偏置，而这一操作恰好只改变最高，相当于将最高位取反，故只需要将最高位取反即可。</p>
<p>在有负电压信号的系统中，无论是有符号数还是无符号数，AD采样负电压信号的值都是以补码的信号存在的，在有些系统中有向量合成取模的操作，涉及平方和开方，只有幅值没有方向，当确定为负电压值时还需要进行取补码的操作，将其转换为有符号数，再将最高位整理成无符号数或者有符号数。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://joyobama.github.io/2022/10/06/Verilog%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B0%E4%B8%8E%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A6%81%E7%82%B9/" data-id="cl8x3ovrx0006bgoc61vk0fm1" data-title="Verilog 有符号数与无符号数的一些注意点" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SIFT" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/06/SIFT/" class="article-date">
  <time class="dt-published" datetime="2022-10-06T13:00:15.663Z" itemprop="datePublished">2022-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://joyobama.github.io/2022/10/06/SIFT/" data-id="cl8x3ovrl0000bgoc9ppnfnqe" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/06/hello-world/" class="article-date">
  <time class="dt-published" datetime="2022-10-06T12:29:27.168Z" itemprop="datePublished">2022-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/06/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://joyobama.github.io/2022/10/06/hello-world/" data-id="cl8x3ovrv0003bgoc6mpcg8tc" data-title="Hello World" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; zurück</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/06/AD%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/">AD简易教程</a>
          </li>
        
          <li>
            <a href="/2022/10/06/2022%E5%B9%B44%E6%9C%88FPGA%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%80%E4%BA%9B%E9%94%99%E8%AF%AF%E8%A6%81%E7%82%B9/">要点总结</a>
          </li>
        
          <li>
            <a href="/2022/10/06/2021%E5%B9%B4%E8%AE%B0%E8%B4%A6/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/10/06/%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E6%9D%BF%E8%A7%84%E5%88%92/">信号处理板计划</a>
          </li>
        
          <li>
            <a href="/2022/10/06/%E6%96%B0%E8%83%BD%E6%BA%90%E6%B1%BD%E8%BD%A6%E7%94%B5%E6%B1%A0%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/">新能源汽车电池数据清洗</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 Joy_Obama<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>